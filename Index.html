<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zelvora ‚Äì AI Coaching & Business Growth</title>
  <style>
    :root {
      --bg: #f6f7fb; --primary: #0c2340; --accent: #1f7aff; --text: #111827;
      --muted: #6b7280; --card: #ffffff; --border: #e5e7eb; --radius-pill: 999px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .page { max-width: 1120px; margin: 0 auto; padding: 22px 16px; }
    
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 26px; }
    .logo-icon { width: 40px; height: 40px; border-radius: 14px; background: var(--primary); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 800; }
    
    .ai-section {
      background: var(--primary); color: white; padding: 30px; border-radius: 28px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.15); margin: 30px 0;
    }
    #chat-output {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      padding: 20px; border-radius: 18px; min-height: 120px; margin-bottom: 20px;
      font-size: 15px; line-height: 1.6; overflow-y: auto; max-height: 300px;
    }
    .input-group {
      display: flex; gap: 10px; background: white; padding: 8px; border-radius: var(--radius-pill);
    }
    input { flex: 1; border: none; outline: none; padding: 0 15px; font-size: 14px; color: var(--text); }
    .btn { padding: 10px 20px; border-radius: var(--radius-pill); border: none; cursor: pointer; font-weight: 600; transition: 0.3s; }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:disabled { background: var(--muted); }
    .btn-mic { background: #f3f4f6; font-size: 20px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: none; cursor: pointer; }

    /* Pulse animation for "Thinking" */
    .thinking { opacity: 0.6; font-style: italic; }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div style="display:flex; align-items:center; gap:12px;">
        <div class="logo-icon">Z</div>
        <div style="font-weight:700; letter-spacing:.08em;">ZELVORA</div>
      </div>
    </header>

    <section class="ai-section">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h2>Zelvora AI Coach</h2>
        <span id="status" style="font-size:11px; opacity:0.7;">‚óè Online</span>
      </div>
      
      <div id="chat-output">"Hello! I am your Zelvora Coach. Tap the mic to practice English or type a business question."</div>

      <div class="input-group">
        <button id="mic-btn" class="btn-mic" title="Voice Input">üé§</button>
        <input type="text" id="user-input" placeholder="Ask about English fluency or Academics...">
        <button id="send-btn" class="btn btn-primary">Send</button>
      </div>
    </section>
  </div>

  <script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // 1. CONFIGURATION
    const API_KEY = "AIzaSyDpueYhA7kc3ciwCet51GJv3_qBf4GtEAo"; // Ensure this is your RESTRICTED key
    const genAI = new GoogleGenerativeAI(API_KEY);
    
    // Using 1.5 Flash for stability or 2.0 Flash for speed
    const model = genAI.getGenerativeModel({ 
      model: "gemini-1.5-flash",
      systemInstruction: "You are the Zelvora Coach. Focus on English fluency, academic help, and business growth for Indian students/entrepreneurs. Keep replies short (under 3 sentences) and encouraging."
    });

    const output = document.getElementById("chat-output");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const micBtn = document.getElementById("mic-btn");
    const status = document.getElementById("status");

    // 2. VOICE OUTPUT (Text-to-Speech)
    function speak(text) {
      // Cancel any ongoing speech before starting new one
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-IN'; // Professional Indian English accent
      utterance.rate = 1.0;
      window.speechSynthesis.speak(utterance);
    }

    // 3. MAIN AI LOGIC
    async function handleRequest() {
      const text = userInput.value.trim();
      if (!text) return;

      // Update UI for user message
      output.innerHTML = `<div style="margin-bottom:10px;"><b>You:</b> ${text}</div>` + 
                         `<div class="thinking" id="current-op">Zelvora is thinking...</div>`;
      
      userInput.value = "";
      sendBtn.disabled = true;

      try {
        const result = await model.generateContent(text);
        const responseText = result.response.text();
        
        // Update UI with AI Response
        document.getElementById("current-op").innerHTML = `<b>Zelvora:</b> ${responseText}`;
        document.getElementById("current-op").removeAttribute("id"); // Remove ID so next message works
        
        speak(responseText);
      } catch (err) {
        console.error(err);
        output.innerHTML += `<div style="color:#ff4d4d;">Error: Please check your API restrictions or connection.</div>`;
      } finally {
        sendBtn.disabled = false;
        output.scrollTop = output.scrollHeight; // Scroll to bottom
      }
    }

    // 4. VOICE INPUT (Speech-to-Text)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.lang = 'en-US';

      micBtn.onclick = () => {
        recognition.start();
        status.innerText = "Listening...";
        status.style.color = "#1f7aff";
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        handleRequest();
      };

      recognition.onend = () => { 
        status.innerText = "‚óè Online"; 
        status.style.color = "inherit";
      };
    } else {
      micBtn.style.display = "none"; // Hide mic if browser doesn't support it
    }

    // Event Listeners
    sendBtn.onclick = handleRequest;
    userInput.addEventListener("keypress", (e) => { if(e.key === "Enter") handleRequest(); });
  </script>
</body>
</html>
